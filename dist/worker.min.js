!function(){"use strict";var v=(t.prototype.getWidth=function(){return null!==this._width?this._width:0},t.prototype.getHeight=function(){return null!==this._height?this._height:0},t.prototype.getData=function(){return null!==this._data?this._data:this._nullData},t.prototype.setDataUnit=function(t,a){this._data instanceof Uint8ClampedArray&&(this._data[t]=a)},t.prototype.pixelAt=function(t,a){var e=this.getWidth(),n=this.getData(),i=4*(e*a+t);return{r:n[i],g:n[1+i],b:n[2+i],a:n[3+i]}},t.prototype.destory=function(){this._data=null,this._width=null,this._height=null},t);function t(t){this._nullData=new Uint8ClampedArray(0);var a=t.width,e=t.height,n=t.data,i=a*e*4;n instanceof Uint8ClampedArray&&n.length===i?this._data=new Uint8ClampedArray(n):n instanceof Array&&n.length===i?this._data=new Uint8ClampedArray(n):this._data=new Uint8ClampedArray(i),this._width=a,this._height=e}function d(t){for(var a=t.getWidth(),e=t.getHeight(),n=t.getData(),i=new v({width:a,height:e,data:n}),r=0;r<a;r++)for(var o=0;o<e;o++){var h=4*(a*o+r),s=i.pixelAt(r,o),g=Math.round((s.r+s.g+s.b)/3);i.setDataUnit(h,g),i.setDataUnit(1+h,g),i.setDataUnit(2+h,g),i.setDataUnit(3+h,255)}return i}function m(t,a,e){var n=t.getWidth(),i=t.getData()[4*(n*e+a)];return 0<=i&&i<255||(i=0),i}function p(t){var a=t.h/360,e=t.s/100,n=t.l/100,i=0,r=0,o=0;if(0==e)o=r=i=function(t){var a=t*w;return a=Math.round(a),a=Math.max(0,a),a=Math.min(255,a)}(n);else{var h=[],s=.5<=n?n+e-n*e:n*(1+e),g=2*n-s;h[0]=a+1/3,h[1]=a,h[2]=a-1/3;for(var u=0;u<h.length;u++){var c=h[u];switch(c<0?c+=1:1<c&&(c-=1),!0){case c<1/6:c=g+6*(s-g)*c;break;case 1/6<=c&&c<.5:c=s;break;case.5<=c&&c<2/3:c=g+(s-g)*(4-6*c);break;default:c=g}h[u]=Math.round(c*w)}i=h[0],r=h[1],o=h[2]}return{r:i,g:r,b:o}}function D(t){return 100*t/w}var w=255,M=function(){return(M=Object.assign||function(t){for(var a,e=1,n=arguments.length;e<n;e++)for(var i in a=arguments[e])Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i]);return t}).apply(this,arguments)};function y(t){return-100<=t&&t<=100}function I(t,a){var e=t.r,n=t.g,i=t.b,r=D(e),o=D(n),h=D(i),s=Math.min(r,o,h),g=Math.max(r,o,h),u=g-s,c=0,l=0,f=(g+s)/2;if(g===s?l=c=0:(g===r&&h<=o?c=(o-h)/u*60+0:g===r&&o<h?c=(o-h)/u*60+360:g===o?c=(h-r)/u*60+120:g===h&&(c=(r-o)/u*60+240),0===f||g===s?l=0:0<f&&f<=127.5?l=u/(g+s):127.5<f&&(l=u/(510-(g+s)))),c=Math.round(c),l=Math.round(100*l),f=Math.round(f),a&&a.value){var d=a.value;d.h&&function(t){return 0<=t&&t<=360}(d.h)&&(c=d.h,c=Math.min(360,c),c=Math.max(0,c)),d.s&&function(t){return 0<=t&&t<=100}(d.s)&&(l=d.s,l=Math.min(100,l),l=Math.max(0,l)),d.l&&function(t){return 0<=t&&t<=100}(d.l)&&(f=d.l,f=Math.min(100,f),f=Math.max(0,f))}else if(a&&a.percent){var m=a.percent;m.h&&y(m.h)&&(c=Math.floor(c*(100+m.h)/100),c=Math.min(360,c),c=Math.max(0,c)),m.s&&y(m.s)&&(l=Math.floor(l*(100+m.s)/100),l=Math.min(100,l),l=Math.max(0,l)),m.l&&y(m.l)&&(f=Math.floor(f*(100+m.l)/100),f=Math.min(100,f),f=Math.max(0,f))}return{h:c,s:l,l:f}}function s(t,a){for(var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=0;o<i.length;o+=4){var h=i[o],s=i[o+1],g=i[o+2],u=i[o+3],c=I({r:h,g:s,b:g},a),l=M({},c),f=p(l);r.setDataUnit(o,f.r),r.setDataUnit(o+1,f.g),r.setDataUnit(o+2,f.b),r.setDataUnit(o+3,u)}return t.destory(),r}function a(t){var a=t.getData(),e=t.getWidth(),n=t.getHeight(),i=new ImageData(e,n);return a.forEach(function(t,a){i.data[a]=t}),i}function h(t){var a=t.data,e=t.width,n=t.height;return new v({width:e,height:n,data:a})}function o(t,a){void 0===a&&(a={type:"image/png",encoderOptions:1});var e=document.createElement("canvas"),n=e.getContext("2d");e.width=t.width,e.height=t.height;var i=null;return n&&(n.clearRect(0,0,e.width,e.height),n.putImageData(t,0,0),i=e.toDataURL(a.type,a.encoderOptions)),i}var e={grayscale:d,sobel:function(t){for(var a=t.getWidth(),e=t.getHeight(),n=new Uint8ClampedArray(a*e*4),i=new v({width:a,height:e,data:n}),r=[[-1,0,1],[-2,0,2],[-1,0,1]],o=[[-1,-2,-1],[0,0,0],[1,2,1]],h=d(t),s=0;s<a;s++)for(var g=0;g<e;g++){var u=r[0][0]*m(h,s-1,g-1)+r[0][1]*m(h,s,g-1)+r[0][2]*m(h,s+1,g-1)+r[1][0]*m(h,s-1,g)+r[1][1]*m(h,s,g)+r[1][2]*m(h,s+1,g)+r[2][0]*m(h,s-1,g+1)+r[2][1]*m(h,s,g+1)+r[2][2]*m(h,s+1,g+1),c=o[0][0]*m(h,s-1,g-1)+o[0][1]*m(h,s,g-1)+o[0][2]*m(h,s+1,g-1)+o[1][0]*m(h,s-1,g)+o[1][1]*m(h,s,g)+o[1][2]*m(h,s+1,g)+o[2][0]*m(h,s-1,g+1)+o[2][1]*m(h,s,g+1)+o[2][2]*m(h,s+1,g+1),l=Math.round(Math.sqrt(u*u+c*c)),f=4*(a*g+s);i.setDataUnit(f,l),i.setDataUnit(1+f,l),i.setDataUnit(2+f,l),i.setDataUnit(3+f,255)}return h.destory(),h=null,i},invert:function(t){for(var a=t.getWidth(),e=t.getHeight(),n=t.getData(),i=new v({width:a,height:e,data:n}),r=0;r<a;r++)for(var o=0;o<e;o++){var h=4*(a*o+r),s=i.pixelAt(r,o);i.setDataUnit(h,w-s.r),i.setDataUnit(1+h,w-s.g),i.setDataUnit(2+h,w-s.b),i.setDataUnit(3+h,s.a)}return i},hue:function(t,a){var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=void 0,h=void 0;return a.value?h={h:a.value}:a.percent&&(o={h:a.percent}),r=s(r,{percent:o,value:h})},saturation:function(t,a){var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=void 0,h=void 0;return a.value?h={s:a.value}:a.percent&&(o={s:a.percent}),r=s(r,{percent:o,value:h})},lightness:function(t,a){var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=void 0,h=void 0;return a.value?h={l:a.value}:a.percent&&(o={l:a.percent}),r=s(r,{percent:o,value:h})},alpha:function(t,a){var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=a.percent,h=a.value;if(o&&function(t){return-100<=t&&t<=100}(o)?(o=Math.min(100,o),o=Math.max(-100,o)):h&&function(t){return 0<=t&&t<=100}(h)&&(h=Math.min(100,h),h=Math.max(0,h)),h||0===h)for(var s=0;s<i.length;s+=4){var g=i[s],u=i[s+1],c=i[s+2],l=i[s+3];l=Math.floor(h*w/100),l=Math.min(w,l),l=Math.max(0,l),r.setDataUnit(s,g),r.setDataUnit(s+1,u),r.setDataUnit(s+2,c),r.setDataUnit(s+3,l)}else if(o||0===o)for(s=0;s<i.length;s+=4){g=i[s],u=i[s+1],c=i[s+2],l=i[s+3];l=Math.floor(l*(100+o)/100),l=Math.min(w,l),l=Math.max(0,l),r.setDataUnit(s,g),r.setDataUnit(s+1,u),r.setDataUnit(s+2,c),r.setDataUnit(s+3,l)}else for(s=0;s<i.length;s+=4){g=i[s],u=i[s+1],c=i[s+2],l=i[s+3];r.setDataUnit(s,g),r.setDataUnit(s+1,u),r.setDataUnit(s+2,c),r.setDataUnit(s+3,l)}return r},sepia:function(t){for(var a=t.getWidth(),e=t.getHeight(),n=t.getData(),i=new v({width:a,height:e,data:n}),r=0;r<a;r++)for(var o=0;o<e;o++){var h=4*(a*o+r),s=i.pixelAt(r,o),g=Math.floor(.393*s.r+.769*s.g+.189*s.b),u=Math.floor(.349*s.r+.686*s.g+.168*s.b),c=Math.floor(.272*s.r+.534*s.g+.131*s.b),l=s.a;i.setDataUnit(h,g),i.setDataUnit(1+h,u),i.setDataUnit(2+h,c),i.setDataUnit(3+h,l)}return i},posterize:function(t,a){void 0===a&&(a={});var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=a.value||100;o&&function(t){return 0<=t&&t<=100}(o)&&(o=Math.min(100,o),o=Math.max(0,o));for(var h=w/o,s=h,g=0;g<e;g++)for(var u=0;u<n;u++){var c=4*(e*u+g),l=r.pixelAt(g,u),f=Math.floor(Math.floor(l.r/h)*s),d=Math.floor(Math.floor(l.g/h)*s),m=Math.floor(Math.floor(l.b/h)*s),p=l.a;r.setDataUnit(c,f),r.setDataUnit(1+c,d),r.setDataUnit(2+c,m),r.setDataUnit(3+c,p)}return r},gamma:function(t,a){void 0===a&&(a={});var e=t.getWidth(),n=t.getHeight(),i=t.getData(),r=new v({width:e,height:n,data:i}),o=a.value||16;o&&function(t){return 0<=t&&t<=100}(o)&&(o=Math.min(100,o),o=Math.max(0,o));for(var h=(o+100)/200*2,s=0;s<e;s++)for(var g=0;g<n;g++){var u=4*(e*g+s),c=r.pixelAt(s,g),l=Math.floor(Math.pow(c.r,h)),f=Math.floor(Math.pow(c.g,h)),d=Math.floor(Math.pow(c.b,h)),m=c.a;r.setDataUnit(u,l),r.setDataUnit(1+u,f),r.setDataUnit(2+u,d),r.setDataUnit(3+u,m)}return r}},g=(n.prototype.process=function(t,a){if(e&&"function"!=typeof e[t])throw new Error("Pictool.digit.process."+t+" is not a function ");return this._digitImageData=e[t](this._digitImageData,a),this},n.prototype.getImageData=function(){return this._digitImageData?a(this._digitImageData):null},n.prototype.getDigitImageData=function(){return this._digitImageData},n.prototype.destory=function(){this._digitImageData&&(this._digitImageData.destory(),this._digitImageData=null)},n);function n(t){this._digitImageData=null,this._digitImageData=t}function u(e){var n=document.createElement("img");return new Promise(function(t,a){n.onload=function(){t(n)},n.onerror=function(){a(new Error("GET_IMAGE_SRC_ERROR"))},n.src=e})}function c(t){return new Promise(function(o,h){u(t).then(function(t){var a=document.createElement("canvas"),e=t.width,n=t.height;a.width=e,a.height=n;var i=a.getContext("2d");if(i){i.clearRect(0,0,a.width,a.height),i.drawImage(t,0,0,e,n);var r=i.getImageData(0,0,e,n);o(r)}else h(new Error("canvas.getContext('2d') is null"))}).catch(function(t){h(t)})})}var b,i;(i=b=b||{}).png="image/png",i.jpg="image/webp",i.jpeg="image/jpeg";function l(t,a){void 0===a&&(a={type:b.png,encoderOptions:1});var e=a.type,n=a.encoderOptions,i=t.width,r=t.height,o=i,h=r,s=i*r,g=Math.ceil(Math.sqrt(Math.ceil(s/4e6)));1<g?(o=i/g,h=r/g):g=1;var u=document.createElement("canvas"),c=document.createElement("canvas"),l=u.getContext("2d");if(!l)return null;u.width=o,u.height=h,l.fillStyle="#FFFFFF",l.fillRect(0,0,u.width,u.height);var f=Math.ceil(s/1e6);if(1<f){var d=Math.ceil(u.width/f),m=Math.ceil(u.height/f);c.width=d,c.height=m;var p=c.getContext("2d");if(!p)return null;for(var v=d*g,D=m*g,w=d,M=m,y=0;y<f;y++)for(var I=0;I<f;I++){var U=y*d*g,_=I*m*g;p.drawImage(t,U,_,v,D,0,0,w,M),l.drawImage(c,y*d,I*m,w,M)}p.clearRect(0,0,c.width,c.height),c.width=0,c.height=0,c=null}else l.drawImage(t,0,0,o,h);var x=u.toDataURL(e,n);return l.clearRect(0,0,u.width,u.height),u.width=0,u.height=0,u=null,x}r.prototype.queueProcess=function(t){var i=this,r=[];return Array.isArray(t)?t.forEach(function(t){r.push(t)}):r.push(t),new Promise(function(e,a){i._getEffectAsync().then(function(n){r.forEach(function(t){var a=t.process,e=t.options;i._digitImg=n.process(a,e).getDigitImageData()});var t=n.getImageData(),a=o(t);e(a)}).catch(function(t){a(t)})})},r.prototype._getEffectAsync=function(){var r=this;return this._effect instanceof g?Promise.resolve(this._effect):new Promise(function(n,i){r._parseDigitAsync().then(function(t){if(!0===t){var a=r._digitImg;if(a instanceof v){var e=new g(a);r._effect=e,n(r._effect)}else i(new Error("_digitImg is null"))}else i(new Error("image src parse fail"))}).catch(function(t){i(t)})})},r.prototype._parseDigitAsync=function(){var i=this;if(this._digitImg)return Promise.resolve(!0);var t=this._options,a=1;t&&(a=t.compressRatio);var r=this._imgSrc,e=Math.max(.1,a);e=Math.min(1,a);var o={type:b.jpg,encoderOptions:e};return new Promise(function(e,n){u(r).then(function(t){var a=l(t,o);"string"==typeof a?c(a).then(function(t){var a=h(t);i._digitImg=a,e(!0)}).catch(function(t){n(t)}):n(new Error("compressImage result is null"))}).catch(function(t){n(t)})})};function r(t,a){this._digitImg=null,this._effect=null,this._imgSrc=t,this._options=a}var f={getImageBySrc:u,getImageDataBySrc:c,compressImage:l,imageData2Base64:o,digitImageData2ImageData:a,imageData2DigitImageData:h},U=Object.freeze({origin:function(t){var a=t.imageData;return f.digitImageData2ImageData(a)},grayscale:function(t){var a=t.imageData,e=new g(a),n=e.process("grayscale").getImageData();return e.destory(),e=null,n},hue:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("hue",e).getImageData();return n.destory(),n=null,i},lightness:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("lightness",e).getImageData();return n.destory(),n=null,i},saturation:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("saturation",e).getImageData();return n.destory(),n=null,i},invert:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("invert",e).getImageData();return n.destory(),n=null,i},sobel:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("sobel",e).getImageData();return n.destory(),n=null,i},lineDrawing:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("sobel",e).process("invert",e).getImageData();return n.destory(),n=null,i},oilDrawing:function(t){var a=t.imageData,e=(t.options,new g(a)),n=e.process("gamma",{value:8}).process("posterize",{value:8}).getImageData();return e.destory(),e=null,n},old:function(t){var a=t.imageData,e=(t.options,new g(a)),n=e.process("sepia").getImageData();return e.destory(),e=null,n},natural:function(t){var a=t.imageData,e=(t.options,new g(a)),n=e.process("saturation",{percent:76}).getImageData();return e.destory(),e=null,n},alpha:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("alpha",e).getImageData();return n.destory(),n=null,i},sepia:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("sepia",e).getImageData();return n.destory(),n=null,i},posterize:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("posterize",e).getImageData();return n.destory(),n=null,i},gamma:function(t){var a=t.imageData,e=t.options,n=new g(a),i=n.process("gamma",e).getImageData();return n.destory(),n=null,i}});onmessage=function(t){var a=(0,U[t.data.key])(t.data.param);postMessage({key:t.data.key,result:a},"")}}();
