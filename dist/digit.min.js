!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define("Pictool.digit",a):((t=t||self).Pictool=t.Pictool||{},t.Pictool.digit=a())}(this,function(){"use strict";function c(t){var a=t.h/360,e=t.s/100,i=t.l/100,n=0,r=0,h=0;if(0==e)h=r=n=function(t){var a=t*p;return a=Math.round(a),a=Math.max(0,a),a=Math.min(255,a)}(i);else{var o=[],g=.5<=i?i+e-i*e:i*(1+e),s=2*i-g;o[0]=a+1/3,o[1]=a,o[2]=a-1/3;for(var u=0;u<o.length;u++){var f=o[u];switch(f<0?f+=1:1<f&&(f-=1),!0){case f<1/6:f=s+6*(g-s)*f;break;case 1/6<=f&&f<.5:f=g;break;case.5<=f&&f<2/3:f=s+(g-s)*(4-6*f);break;default:f=s}o[u]=Math.round(f*p)}n=o[0],r=o[1],h=o[2]}return{r:n,g:r,b:h}}function v(t){return 100*t/p}var D=function(){return(D=Object.assign||function(t){for(var a,e=1,i=arguments.length;e<i;e++)for(var n in a=arguments[e])Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n]);return t}).apply(this,arguments)},p=255;function m(t){return-100<=t&&t<=100}function M(t,a){var e=t.r,i=t.g,n=t.b,r=v(e),h=v(i),o=v(n),g=Math.min(r,h,o),s=Math.max(r,h,o),u=s-g,f=0,l=0,d=(s+g)/2;if(s===g?l=f=0:(s===r&&o<=h?f=(h-o)/u*60+0:s===r&&h<o?f=(h-o)/u*60+360:s===h?f=(o-r)/u*60+120:s===o&&(f=(r-h)/u*60+240),0===d||s===g?l=0:0<d&&d<=127.5?l=u/(s+g):127.5<d&&(l=u/(510-(s+g)))),f=Math.round(f),l=Math.round(100*l),d=Math.round(d),a&&a.value){var c=a.value;c.h&&function(t){return 0<=t&&t<=360}(c.h)&&(f=c.h,f=Math.min(360,f),f=Math.max(0,f)),c.s&&function(t){return 0<=t&&t<=100}(c.s)&&(l=c.s,l=Math.min(100,l),l=Math.max(0,l)),c.l&&function(t){return 0<=t&&t<=100}(c.l)&&(d=c.l,d=Math.min(100,d),d=Math.max(0,d))}else if(a&&a.percent){var D=a.percent;D.h&&m(D.h)&&(f=Math.floor(f*(100+D.h)/100),f=Math.min(360,f),f=Math.max(0,f)),D.s&&m(D.s)&&(l=Math.floor(l*(100+D.s)/100),l=Math.min(100,l),l=Math.max(0,l)),D.l&&m(D.l)&&(d=Math.floor(d*(100+D.l)/100),d=Math.min(100,d),d=Math.max(0,d))}return{h:f,s:l,l:d}}var U=(t.prototype.getWidth=function(){return null!==this._width?this._width:0},t.prototype.getHeight=function(){return null!==this._height?this._height:0},t.prototype.getData=function(){return null!==this._data?this._data:this._nullData},t.prototype.setDataUnit=function(t,a){this._data instanceof Uint8ClampedArray&&(this._data[t]=a)},t.prototype.pixelAt=function(t,a){var e=this.getWidth(),i=this.getData(),n=4*(e*a+t);return{r:i[n],g:i[1+n],b:i[2+n],a:i[3+n]}},t.prototype.destory=function(){this._data=null,this._width=null,this._height=null},t);function t(t){this._nullData=new Uint8ClampedArray(0);var a=t.width,e=t.height,i=t.data,n=a*e*4;i instanceof Uint8ClampedArray&&i.length===n?this._data=new Uint8ClampedArray(i):i instanceof Array&&i.length===n?this._data=new Uint8ClampedArray(i):this._data=new Uint8ClampedArray(n),this._width=a,this._height=e}function g(t,a){for(var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=0;h<n.length;h+=4){var o=n[h],g=n[h+1],s=n[h+2],u=n[h+3],f=M({r:o,g:g,b:s},a),l=D({},f),d=c(l);r.setDataUnit(h,d.r),r.setDataUnit(h+1,d.g),r.setDataUnit(h+2,d.b),r.setDataUnit(h+3,u)}return t.destory(),r}function w(t){for(var a=t.getWidth(),e=t.getHeight(),i=t.getData(),n=new U({width:a,height:e,data:i}),r=0;r<a;r++)for(var h=0;h<e;h++){var o=4*(a*h+r),g=n.pixelAt(r,h),s=Math.round((g.r+g.g+g.b)/3);n.setDataUnit(o,s),n.setDataUnit(1+o,s),n.setDataUnit(2+o,s),n.setDataUnit(3+o,255)}return n}function y(t,a,e){var i=t.getWidth(),n=t.getData()[4*(i*e+a)];return 0<=n&&n<255||(n=0),n}var e={grayscale:w,sobel:function(t){for(var a=t.getWidth(),e=t.getHeight(),i=new Uint8ClampedArray(a*e*4),n=new U({width:a,height:e,data:i}),r=[[-1,0,1],[-2,0,2],[-1,0,1]],h=[[-1,-2,-1],[0,0,0],[1,2,1]],o=w(t),g=0;g<a;g++)for(var s=0;s<e;s++){var u=r[0][0]*y(o,g-1,s-1)+r[0][1]*y(o,g,s-1)+r[0][2]*y(o,g+1,s-1)+r[1][0]*y(o,g-1,s)+r[1][1]*y(o,g,s)+r[1][2]*y(o,g+1,s)+r[2][0]*y(o,g-1,s+1)+r[2][1]*y(o,g,s+1)+r[2][2]*y(o,g+1,s+1),f=h[0][0]*y(o,g-1,s-1)+h[0][1]*y(o,g,s-1)+h[0][2]*y(o,g+1,s-1)+h[1][0]*y(o,g-1,s)+h[1][1]*y(o,g,s)+h[1][2]*y(o,g+1,s)+h[2][0]*y(o,g-1,s+1)+h[2][1]*y(o,g,s+1)+h[2][2]*y(o,g+1,s+1),l=Math.round(Math.sqrt(u*u+f*f)),d=4*(a*s+g);n.setDataUnit(d,l),n.setDataUnit(1+d,l),n.setDataUnit(2+d,l),n.setDataUnit(3+d,255)}return o.destory(),o=null,n},invert:function(t){for(var a=t.getWidth(),e=t.getHeight(),i=t.getData(),n=new U({width:a,height:e,data:i}),r=0;r<a;r++)for(var h=0;h<e;h++){var o=4*(a*h+r),g=n.pixelAt(r,h);n.setDataUnit(o,p-g.r),n.setDataUnit(1+o,p-g.g),n.setDataUnit(2+o,p-g.b),n.setDataUnit(3+o,g.a)}return n},hue:function(t,a){var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=void 0,o=void 0;return a.value?o={h:a.value}:a.percent&&(h={h:a.percent}),r=g(r,{percent:h,value:o})},saturation:function(t,a){var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=void 0,o=void 0;return a.value?o={s:a.value}:a.percent&&(h={s:a.percent}),r=g(r,{percent:h,value:o})},lightness:function(t,a){var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=void 0,o=void 0;return a.value?o={l:a.value}:a.percent&&(h={l:a.percent}),r=g(r,{percent:h,value:o})},alpha:function(t,a){var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=a.percent,o=a.value;if(h&&function(t){return-100<=t&&t<=100}(h)?(h=Math.min(100,h),h=Math.max(-100,h)):o&&function(t){return 0<=t&&t<=100}(o)&&(o=Math.min(100,o),o=Math.max(0,o)),o||0===o)for(var g=0;g<n.length;g+=4){var s=n[g],u=n[g+1],f=n[g+2],l=n[g+3];l=Math.floor(o*p/100),l=Math.min(p,l),l=Math.max(0,l),r.setDataUnit(g,s),r.setDataUnit(g+1,u),r.setDataUnit(g+2,f),r.setDataUnit(g+3,l)}else if(h||0===h)for(g=0;g<n.length;g+=4){s=n[g],u=n[g+1],f=n[g+2],l=n[g+3];l=Math.floor(l*(100+h)/100),l=Math.min(p,l),l=Math.max(0,l),r.setDataUnit(g,s),r.setDataUnit(g+1,u),r.setDataUnit(g+2,f),r.setDataUnit(g+3,l)}else for(g=0;g<n.length;g+=4){s=n[g],u=n[g+1],f=n[g+2],l=n[g+3];r.setDataUnit(g,s),r.setDataUnit(g+1,u),r.setDataUnit(g+2,f),r.setDataUnit(g+3,l)}return r},sepia:function(t){for(var a=t.getWidth(),e=t.getHeight(),i=t.getData(),n=new U({width:a,height:e,data:i}),r=0;r<a;r++)for(var h=0;h<e;h++){var o=4*(a*h+r),g=n.pixelAt(r,h),s=Math.floor(.393*g.r+.769*g.g+.189*g.b),u=Math.floor(.349*g.r+.686*g.g+.168*g.b),f=Math.floor(.272*g.r+.534*g.g+.131*g.b),l=g.a;n.setDataUnit(o,s),n.setDataUnit(1+o,u),n.setDataUnit(2+o,f),n.setDataUnit(3+o,l)}return n},posterize:function(t,a){void 0===a&&(a={});var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=a.value||100;h&&function(t){return 0<=t&&t<=100}(h)&&(h=Math.min(100,h),h=Math.max(0,h));for(var o=p/h,g=o,s=0;s<e;s++)for(var u=0;u<i;u++){var f=4*(e*u+s),l=r.pixelAt(s,u),d=Math.floor(Math.floor(l.r/o)*g),c=Math.floor(Math.floor(l.g/o)*g),D=Math.floor(Math.floor(l.b/o)*g),v=l.a;r.setDataUnit(f,d),r.setDataUnit(1+f,c),r.setDataUnit(2+f,D),r.setDataUnit(3+f,v)}return r},gamma:function(t,a){void 0===a&&(a={});var e=t.getWidth(),i=t.getHeight(),n=t.getData(),r=new U({width:e,height:i,data:n}),h=a.value||16;h&&function(t){return 0<=t&&t<=100}(h)&&(h=Math.min(100,h),h=Math.max(0,h));for(var o=(h+100)/200*2,g=0;g<e;g++)for(var s=0;s<i;s++){var u=4*(e*s+g),f=r.pixelAt(g,s),l=Math.floor(Math.pow(f.r,o)),d=Math.floor(Math.pow(f.g,o)),c=Math.floor(Math.pow(f.b,o)),D=f.a;r.setDataUnit(u,l),r.setDataUnit(1+u,d),r.setDataUnit(2+u,c),r.setDataUnit(3+u,D)}return r}},a={transform:{HSL2RGB:c,RGB2HSL:M},process:e,DigitImageData:U},i=(n.prototype.process=function(t,a){if(e&&"function"!=typeof e[t])throw new Error("Pictool.digit.process."+t+" is not a function ");return this._digitImageData=e[t](this._digitImageData,a),this},n.prototype.getImageData=function(){return this._digitImageData?function(t){var a=t.getData(),e=t.getWidth(),i=t.getHeight(),n=new ImageData(e,i);return a.forEach(function(t,a){n.data[a]=t}),n}(this._digitImageData):null},n.prototype.getDigitImageData=function(){return this._digitImageData},n.prototype.destory=function(){this._digitImageData&&(this._digitImageData.destory(),this._digitImageData=null)},n);function n(t){this._digitImageData=null,this._digitImageData=t}return{transform:a.transform,process:a.process,DigitImageData:a.DigitImageData,Effect:i}});
