!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Pictool.UI",e):((t=t||self).Pictool=t.Pictool||{},t.Pictool.UI=e())}(this,function(){"use strict";function t(t,e){void 0===e&&(e={});var o=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}t(".pictool-component-mask{display:none;background:rgba(0,0,0,.48);position:fixed;left:0;right:0;top:0;bottom:0}.pictool-component-mask .pictool-mask-container{position:absolute;left:0;right:0;bottom:-100%;height:100%;width:100%;background:#fff;transition:.6s}.pictool-component-mask.mask-open{display:block}.pictool-component-mask.mask-open .pictool-mask-container{bottom:0}.pictool-component-mask .pictool-mask-header{position:absolute;top:0;width:100%;height:40px;background:#222}.pictool-component-mask .pictool-mask-content{position:absolute;top:40px;bottom:120px;width:100%;background:#333}.pictool-component-mask .pictool-mask-footer{position:absolute;bottom:0;width:100%;height:120px;background:#222}");var n=(e.prototype.show=function(){this._component.classList.add("mask-open")},e.prototype.hide=function(){this._component.classList.remove("mask-open")},e.prototype._render=function(){if(!0!==this._hasRendered){var t=this._options,e=t.zIndex,o=t.afterRender,n='\n    <div class="pictool-component-mask" style="z-index: '+e+'">\n      <div class="pictool-mask-container">\n        <div class="pictool-mask-header"></div>\n        <div class="pictool-mask-content"></div>\n        <div class="pictool-mask-footer"></div>\n      </div>\n    </div>\n    ',i=document.querySelector("body"),a=document.createElement("div");a.innerHTML=n;var r=a.querySelector("div.pictool-component-mask");i.appendChild(r);var c=r.querySelector("div.pictool-mask-content"),s=r.querySelector("div.pictool-mask-header"),l=r.querySelector("div.pictool-mask-footer");"function"==typeof o&&o({contentMount:c,headerMount:s,footerMount:l}),this._hasRendered=!0,this._component=r}},e);function e(t){this._hasRendered=!1,this._component=null,this._options=t,this._render()}t(".pictool-module-sketch{width:100%;height:100%;display:table}.pictool-module-sketch .pictool-sketch-container{width:100%;height:100%;display:table-row}.pictool-module-sketch .pictool-sketch-main{width:100%;height:100%;display:table-cell;vertical-align:middle;text-align:center}.pictool-module-sketch .pictool-sketch-main .pictool-sketch-canvas{max-height:100%;max-width:100%}.pictool-module-sketch .pictool-sketch-hidden-area{width:0;height:0;display:none}");var i=function(t,e){var o=t.getContext("2d");t.width=e.width,t.height=e.height,o.clearRect(0,0,t.width,t.height),o.putImageData(e,0,0)},o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function a(t){return(Object.prototype.toString.call(t)||"").replace(/(\[object|\])/gi,"").trim()}var s=function(t,e){var o=a(t);return!0===e?o.toLocaleLowerCase():o},r=function(t){return"Array"===a(t)},c=function(t){return"Object"===a(t)},l=function(t){return"Function"===a(t)},d=function(t){return"Null"===a(t)},h=function(t){return"Promise"===a(t)},p=function(t){return"NodeList"===a(t)},u={fillStyle:{type:"attribute",argumentsType:"string",executeAction:function(t,e){t.fillStyle=e}},fillRect:{type:"function",argumentsType:"array",executeAction:function(t,e){t.fillRect(e[0],e[1],e[2],e[3])}},clearRect:{type:"function",argumentsType:"array",executeAction:function(t,e){t.clearRect(e[0],e[1],e[2],e[3])}},putImageData:{type:"function",argumentsType:"array",executeAction:function(t,e){t.putImageData(e[0],e[1],e[2])}}},v=(g.prototype.getLayerContext=function(){return this._context},g.prototype.clearDrawAction=function(){var t=this._options,e=t.width,o=t.height;this._context.clearRect(0,0,e,o),this._layerSchema={key:"",drawActionList:[]}},g.prototype._executeDrawAction=function(){for(var t,e,o,n,i=this._layerSchema.drawActionList,a=this._context,r=0;r<i.length;r++){var c=i[r];t=a,e=c.method,o=c.args,n=void 0,(n=u[e])&&s(o,!0)===n.argumentsType?n.executeAction(t,o):console.warn("Layer can't support execute context."+e)}},g.prototype.draw=function(t){this._layerSchema=t,this._executeDrawAction()},g.prototype.getSchema=function(){return this._layerSchema},g);function g(t,e){this._context=t,this._options=e}var f=(m.prototype._initSketch=function(){var t=this._width,e=this._height;this._tempCanvas=document.createElement("canvas"),this._tempCanvas.width=t,this._tempCanvas.height=e;for(var o=this._layerCount,n=0;n<o;n++){var i=document.createElement("canvas");i.width=t,i.height=e;var a=i.getContext("2d"),r=new v(a,{width:t,height:e});this._layerStack.push(r),this._canvasStack.push(i)}},m.prototype.getCanvasStack=function(){return this._canvasStack},m.prototype.getLayerStack=function(){return this._layerStack},m.prototype.drawLayer=function(t,e){var o=this._layerStack[t];o.clearDrawAction(),o.draw(e)},m.prototype.drawAllLayer=function(t){var o=this;t.layerList.forEach(function(t,e){o.drawLayer(e,t)})},m.prototype.getSchema=function(){var o=[];return this._layerStack.forEach(function(t){var e=t.getSchema();o.push(e)}),{layerList:o}},m.prototype.mergeLayer=function(){var t=this._tempCanvas,e=this._width,o=this._height,n=t.getContext("2d");n.clearRect(0,0,e,o),this._canvasStack.forEach(function(t){n.drawImage(t,0,0)});var i=n.getImageData(0,0,e,o);return n.clearRect(0,0,e,o),i},m.prototype.moveUpLayer=function(t){},m.prototype.moveDownLayer=function(t){},m);function m(t){this._canvasStack=[],this._layerStack=[],this._tempCanvas=null,this._width=t.width,this._height=t.height,this._layerCount=t.layerCount,this._initSketch()}function b(o){var n=[];return Object.keys(o).forEach(function(t){if("string"==typeof t){var e=o[t]||"";"string"==typeof e&&n.push(t+":"+e)}}),n.join(";")}var _,k,y,w=(o(_=S,k=y=f),void(_.prototype=null===k?Object.create(k):(x.prototype=k.prototype,new x)),S.prototype.render=function(t){this._sketchSchema=t;for(var e=this._container;e.firstChild;)e.removeChild(e.firstChild);var o=this._options,n=o.width,i=o.height,a=o.layerCount,r=b({width:n+"px",height:i+"px",position:"relative",display:"inline-block"}),c=this.getCanvasStack();e.setAttribute("style",r);for(var s=a,l=0;l<s;l++){var d=c[l];d.width=n,d.height=i,d.setAttribute("style",b({width:n+"px",height:i+"px",position:"absolute",left:"0",top:"0"})),e.appendChild(d)}this.drawAllLayer(t)},S.prototype.renderLayer=function(t,e){this.drawLayer(t,e)},S.prototype.downloadImage=function(t){void 0===t&&(t="download-image");var e=this._options,o=e.width,n=e.height,i=document.createElement("canvas");i.width=o,i.height=n;var a=i.getContext("2d"),r=this.mergeLayer();a.putImageData(r,0,0);var c=i.toDataURL("image/png"),s=document.createElement("a");s.href=c,s.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),s.dispatchEvent(l),a.clearRect(0,0,o,n),i=null},S);function x(){this.constructor=_}function S(t){var e=y.call(this,{width:t.width,height:t.height,layerCount:t.layerCount})||this;return e._options=t,e._container=t.container,e}function C(){this._listeners=new Map}var E=new(C.prototype.on=function(t,e){this._listeners.set(t,e)},C.prototype.remove=function(t){this._listeners.delete(t)},C.prototype.trigger=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n=this._listeners.get(t);return!!l(n)&&(n.apply(void 0,e),!0)},C),L=new Map,z=function(t,e){L.set(t,e)},M=function(t){return L.get(t)},I=function(t){return t.layerList[0].drawActionList[0].args[0]},R=function(t){return{layerList:[{key:"image",drawActionList:[{method:"putImageData",args:[t,0,0]}]}]}},P=(A.prototype.renderImage=function(t){var e=this._sketchpad;e.render(t);var o=e.mergeLayer(),n=this._mount.querySelector("canvas.pictool-sketch-canvas");i(n,o),z("Sketch.sketchSchema",t)},A.prototype._render=function(){!0!==this._hasRendered&&(this._mount.innerHTML='\n      <div class="pictool-module-sketch">\n        <div class="pictool-sketch-container">\n          <div class="pictool-sketch-main">\n            <div class="pictool-sketch-entity">\n              <canvas class="pictool-sketch-canvas"></canvas>\n            </div>\n          </div>\n        </div>\n        <div class="pictool-sketch-hidden-area">\n          <div class="pictool-sketch-hidden-area-sketchpad"></div>\n        </div>\n      </div>\n    ',this._hasRendered=!0)},A);function A(t,e){this._mount=null,this._opts=null,this._hasRendered=!1,this._sketchpad=null;var o=this;this._mount=t,this._opts=e,this._render();var n=this._opts.imageData,i=this._mount.querySelector("div.pictool-sketch-hidden-area-sketchpad"),a=n.height,r=n.width,c=new w({height:a,width:r,layerCount:2,container:i});this._sketchpad=c;var s=R(n);z("Sketch.originSketchSchema",s),E.on("GlobalEvent.moduleSketch.renderImage",function(t){o.renderImage(t)}),E.on("GlobalEvent.moduleSketch.downloadImage",function(){c.downloadImage("download-pictool.png")})}t(".pictool-module-dashboard{height:100%;width:100%;position:relative;font-size:14px;color:#333}.pictool-module-dashboard .pictool-dashboard-navlist{position:absolute;height:80px;display:flex;background:#fff;width:100%;bottom:0}.pictool-module-dashboard .pictool-dashboard-nav-btn{flex:1;text-align:center;font-size:14px;padding-top:40px;position:relative}.pictool-module-dashboard .pictool-dashboard-nav-btn.dashboard-filter:before{content:\"\";position:absolute;top:0;left:0;right:0;height:40px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cdefs%3E%3Cstyle/%3E%3C/defs%3E%3Cpath d='M632 888H392c-4.4 0-8 3.6-8 8v32c0 17.7 14.3 32 32 32h192c17.7 0 32-14.3 32-32v-32c0-4.4-3.6-8-8-8zM512 64c-181.1 0-328 146.9-328 328 0 121.4 66 227.4 164 284.1V792c0 17.7 14.3 32 32 32h264c17.7 0 32-14.3 32-32V676.1c98-56.7 164-162.7 164-284.1 0-181.1-146.9-328-328-328zm127.9 549.8L604 634.6V752H420V634.6l-35.9-20.8C305.4 568.3 256 484.5 256 392c0-141.4 114.6-256 256-256s256 114.6 256 256c0 92.5-49.4 176.3-128.1 221.8z' fill='%23666'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:bottom;background-size:30px}.pictool-module-dashboard .pictool-dashboard-nav-btn.dashboard-adjust:before{content:\"\";position:absolute;top:0;left:0;right:0;height:40px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M924.8 385.6c-22.6-53.4-54.9-101.3-96-142.4-41.1-41.1-89-73.4-142.4-96C631.1 123.8 572.5 112 512 112s-119.1 11.8-174.4 35.2c-53.4 22.6-101.3 54.9-142.4 96-41.1 41.1-73.4 89-96 142.4C75.8 440.9 64 499.5 64 560c0 132.7 58.3 257.7 159.9 343.1l1.7 1.4c5.8 4.8 13.1 7.5 20.6 7.5h531.7c7.5 0 14.8-2.7 20.6-7.5l1.7-1.4C901.7 817.7 960 692.7 960 560c0-60.5-11.9-119.1-35.2-174.4zM761.4 836H262.6C184.5 765.5 140 665.6 140 560c0-99.4 38.7-192.8 109-263 70.3-70.3 163.7-109 263-109 99.4 0 192.8 38.7 263 109 70.3 70.3 109 163.7 109 263 0 105.6-44.5 205.5-122.6 276z' fill='%23666'/%3E%3Cpath d='M623.5 421.5c-3.1-3.1-8.2-3.1-11.3 0L527.7 506c-18.7-5-39.4-.2-54.1 14.5-21.9 21.9-21.9 57.3 0 79.2 21.9 21.9 57.3 21.9 79.2 0 14.7-14.7 19.5-35.4 14.5-54.1l84.5-84.5c3.1-3.1 3.1-8.2 0-11.3l-28.3-28.3zM490 320h44c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8h-44c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8zm260 218v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8h-80c-4.4 0-8 3.6-8 8zm12.7-197.2l-31.1-31.1c-3.1-3.1-8.2-3.1-11.3 0l-56.6 56.6c-3.1 3.1-3.1 8.2 0 11.3l31.1 31.1c3.1 3.1 8.2 3.1 11.3 0l56.6-56.6c3.1-3.1 3.1-8.2 0-11.3zm-458.6-31.1c-3.1-3.1-8.2-3.1-11.3 0l-31.1 31.1c-3.1 3.1-3.1 8.2 0 11.3l56.6 56.6c3.1 3.1 8.2 3.1 11.3 0l31.1-31.1c3.1-3.1 3.1-8.2 0-11.3l-56.6-56.6zM262 530h-80c-4.4 0-8 3.6-8 8v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8z' fill='%23666'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:bottom;background-size:30px}.pictool-module-dashboard .pictool-dashboard-nav-btn.dashboard-edit:before{content:\"\";position:absolute;top:0;left:0;right:0;height:40px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z' fill='%23666'/%3E%3Cpath d='M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415c-1.4 1.5-2.3 3.5-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z' fill='%23666'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:bottom;background-size:30px}.pictool-module-dashboard .pictool-dashboard-nav-btn.dashboard-text:before{content:\"\";position:absolute;top:0;left:0;right:0;height:40px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M904 816H120c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8zm-650.3-80h85c4.2 0 8-2.7 9.3-6.8l53.7-166h219.2l53.2 166c1.3 4 5 6.8 9.3 6.8h89.1c1.1 0 2.2-.2 3.2-.5 5.1-1.8 7.8-7.3 6-12.4L573.6 118.6c-1.4-3.9-5.1-6.6-9.2-6.6H462.1c-4.2 0-7.9 2.6-9.2 6.6L244.5 723.1c-.4 1-.5 2.1-.5 3.2-.1 5.3 4.3 9.7 9.7 9.7zm255.9-516.1h4.1l83.8 263.8H424.9l84.7-263.8z' fill='%23666'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:bottom;background-size:30px}");t(".pictool-component-progress{width:100%;height:28px;display:block}.pictool-component-progress.progress-hidden{display:none}.pictool-component-progress .pictool-progress-outer{position:relative;height:28px;width:100%;background:#fff;border-radius:14px;overflow:hidden}.pictool-component-progress .pictool-progress-inner{position:absolute;height:28px;width:100%;background:#00d4ff;border-radius:14px}");function D(t){void 0===t&&(t={});var e=[];if(!0===c(t))for(var o in t){var n=""+o,i=""+t[o];n=n.trim(),i=i.trim(),e.push(n+":"+i)}return e.join("; ")}var q=(H.prototype._render=function(){if(!0!==this._hasRendered){var t=this._options,e=t.mount,o=t.customStyle,n=t.percent,i='\n      <div class="pictool-component-progress" style="'+D(o)+'">\n        <div class="pictool-progress-outer">\n          <div class="pictool-progress-inner"></div>\n        </div>\n      </div>\n    ',a=document.createElement("div");a.innerHTML=i;var r=a.querySelector("div.pictool-component-progress");e.appendChild(r),this._component=r,this._setInnerMovePercent(n),this._triggerEvent()}},H.prototype.show=function(){this._component.classList.remove("progress-hidden")},H.prototype.hide=function(){this._component.classList.add("progress-hidden")},H.prototype.resetPercent=function(t){this._setInnerMovePercent(t)},H.prototype.resetOnChange=function(t){this._options.onChange=t},H.prototype._triggerEvent=function(){var n=this,t=(this._options,this._component),e=t.querySelector(".pictool-progress-outer");t.querySelector(".pictool-progress-inner"),e.addEventListener("touchstart",function(t){var e=t.touches[0].clientX,o=n._calculateMovePercent(e);n._setInnerMovePercent(o)}),e.addEventListener("touchmove",function(t){var e=t.touches[0].clientX,o=n._calculateMovePercent(e);n._setInnerMovePercent(o)}),e.addEventListener("touchend",function(){var t={value:n._getInnerValue()},e=n._options.onChange;l(e)&&e(t)})},H.prototype._calculateMovePercent=function(t){var e=this._component.querySelector(".pictool-progress-outer"),o=this._getViewAbsoluteLeft(e),n=e.clientWidth,i=t-o;return Math.ceil(100*i/n)},H.prototype._setInnerMovePercent=function(t){var e=this._component.querySelector(".pictool-progress-inner"),o=0<t?t:0;o=Math.min(o,100),o=Math.max(o,0);var n=D({left:"-"+(100-o)+"%"});e.setAttribute("style",n),e.setAttribute("data-component-inner-percent",""+o)},H.prototype._getInnerValue=function(){var t=this._component.querySelector(".pictool-progress-inner").getAttribute("data-component-inner-percent"),e=parseInt(t,10);return e=Math.min(100,e),e=Math.max(0,e),e=this._rangeList[e]},H.prototype._getViewAbsoluteLeft=function(t){for(var e=t.offsetLeft,o=t.offsetParent;null!==o;)e+=o.offsetLeft,o=o.offsetParent;return e},H);function H(t){this._options=null,this._hasRendered=!1,this._component=null,this._options=t,this._render(),this._rangeList=[];for(var e=this._options,o=e.max,n=void 0===o?100:o,i=e.min,a=void 0===i?0:i,r=(n-a)/100,c=a;c<n;c+=r)this._rangeList.push(c);this._rangeList.push(n)}t("@keyframes loading-animate{0%{width:0}to{width:90%}}.pictool-component-loading{position:fixed;left:0;right:0;top:0;bottom:0;z-index:1000;background:rgba(0,0,0,.67);display:none}.pictool-component-loading.loading-show{display:block}.pictool-component-loading.loading-show .pictool-loading-inner{height:100%;width:90%;background:-webkit-linear-gradient(left,rgba(75,240,248,.51),#3d7bd9);background:-moz-linear-gradient(left,rgba(75,240,248,.51),#3f7dd9);background:-o-linear-gradient(left,rgba(75,240,248,.51),#3d7bd9);background:-ms-linear-gradient(left,rgba(75,240,248,.51),#3d7bd9);background:linear-gradient(left,rgba(75,240,248,.51),#3d7bd9);border-radius:10px;box-shadow:inset 0 -2px 2px rgba(0,0,0,.2);animation:loading-animate 10s linear}.pictool-component-loading.loading-show .pictool-loading-outer{position:absolute;top:50%;left:10%;right:10%;height:10px;border-radius:10px;background:-webkit-linear-gradient(left,#e4e3e4,#e4e5e4);background:-moz-linear-gradient(left,#e4e3e4,#e4e5e4);background:-o-linear-gradient(left,#e4e3e4,#e4e5e4);background:-ms-linear-gradient(left,#e4e3e4,#e4e5e4);background:linear-gradient(left,#e4e3e4,#e4e5e4)}");var T=(j.prototype._render=function(){if(!0!==this._hasRendered){var t=this._options,e=t.mount,o='\n      <div class="pictool-component-loading" style="z-index:'+t.zIndex+';">\n        <div class="pictool-loading-outer">\n          <div class="pictool-loading-inner"></div>\n        </div>\n      </div>\n    ',n=document.createElement("div");n.innerHTML=o;var i=n.querySelector("div.pictool-component-loading");e instanceof HTMLElement?e.appendChild(i):document.querySelector("body").appendChild(i),this._component=i}},j.prototype.show=function(t){var e=this;this._component.classList.add("loading-show"),0<t&&setTimeout(function(){e.hide()},t)},j.prototype.hide=function(){this._component.classList.remove("loading-show")},j);function j(t){this._options=null,this._hasRendered=!1,this._component=null,this._options=t,this._render()}t(".pictool-component-actionsheet{display:none;background:hsla(0,0%,100%,0);position:fixed;left:0;right:0;bottom:0;font-size:14px;color:#333}.pictool-component-actionsheet .pictool-actionsheet-container{position:absolute;left:0;right:0;bottom:0;height:100%;width:100%;background:#fff;transition:.6s}.pictool-component-actionsheet.actionsheet-open{display:block}.pictool-component-actionsheet .pictool-actionsheet-content{position:absolute;top:0;bottom:0;width:100%;background:#fff}");var V=(G.prototype.show=function(){var t=this._options,e=t.beforeShow,o=t.afterShow,n=this._contentMount;"function"==typeof e&&e({contentMount:n}),this._component.classList.add("actionsheet-open"),"function"==typeof o&&o({contentMount:n})},G.prototype.hide=function(){var t=this._options,e=t.beforeHide,o=t.afterHide,n=this._contentMount;"function"==typeof e&&e({contentMount:n}),this._component.classList.remove("actionsheet-open"),"function"==typeof o&&o({contentMount:n})},G.prototype._render=function(){if(!0!==this._hasRendered){var t=this._options,e=t.afterRender,o=t.beforeRender,n=t.mount;"function"==typeof o&&o();var i=this._options,a='\n    <div class="pictool-component-actionsheet" style="height:'+i.height+"px; z-index: "+i.zIndex+';">\n      <div class="pictool-actionsheet-container">\n        <div class="pictool-actionsheet-header"></div>\n        <div class="pictool-actionsheet-content"></div>\n        <div class="pictool-actionsheet-footer"></div>\n      </div>\n    </div>\n    ',r=document.querySelector("body"),c=document.createElement("div");c.innerHTML=a;var s=c.querySelector("div.pictool-component-actionsheet");n?n.appendChild(s):r.appendChild(s);var l=s.querySelector("div.pictool-actionsheet-content");"function"==typeof e&&e({contentMount:l}),this._hasRendered=!0,this._component=s,this._contentMount=l}},G);function G(t){this._hasRendered=!1,this._component=null,this._contentMount=null,this._options=t,this._render()}t(".pictool-module-panel{height:100%;width:100%;position:relative;font-size:14px;color:#333}.pictool-module-panel .pictool-panel-header{position:absolute;top:0;left:0;right:0;height:40px;box-shadow:0 0 6px 0 rgba(0,0,0,.08)}.pictool-module-panel .pictool-panel-header .pictool-panel-title{line-height:40px;text-align:center;font-size:16px}.pictool-module-panel .pictool-panel-header .pictool-panel-btn-close{position:absolute;right:0;top:0;width:60px;height:40px}.pictool-module-panel .pictool-panel-header .pictool-panel-btn-close:before{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M685.4 354.8c0-4.4-3.6-8-8-8l-66 .3L512 465.6l-99.3-118.4-66.1-.3c-4.4 0-8 3.5-8 8 0 1.9.7 3.7 1.9 5.2l130.1 155L340.5 670c-1.2 1.5-1.9 3.3-1.9 5.2 0 4.4 3.6 8 8 8l66.1-.3L512 564.4l99.3 118.4 66 .3c4.4 0 8-3.5 8-8 0-1.9-.7-3.7-1.9-5.2L553.5 515l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z' fill='%23666'/%3E%3Cpath d='M512 65C264.6 65 64 265.6 64 513s200.6 448 448 448 448-200.6 448-448S759.4 65 512 65zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z' fill='%23666'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:50%;background-size:30px}.pictool-module-panel .pictool-panel-navigation{position:absolute;height:80px;width:100%;bottom:0;background:rgba(33,150,243,.05);overflow:auto;-webkit-overflow-scrolling:touch}.pictool-module-panel .pictool-panel-navlist{width:100%;height:100%;display:flex;-webkit-overflow-scrolling:touch}.pictool-module-panel .pictool-panel-navlist.panel-beyond-width{display:block}.pictool-module-panel .pictool-panel-navlist.panel-beyond-width .pictool-panel-nav-btn{width:80px;display:block;float:left}.pictool-module-panel .pictool-panel-nav-btn{flex:1;text-align:center;font-size:14px;position:relative;padding-top:40px}.pictool-module-panel .pictool-panel-nav-btn.panelnav-icon:before{content:\"\";position:absolute;top:0;left:0;right:0;height:40px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M288 421a48 48 0 1 0 96 0 48 48 0 1 0-96 0zM640 421a48 48 0 1 0 96 0 48 48 0 1 0-96 0z' fill='%23666'/%3E%3Cpath d='M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2-44.3-18.7-84.1-45.6-118.3-79.8-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8c18.7-44.3 45.6-84.1 79.8-118.3 34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2 44.3 18.7 84.1 45.6 118.3 79.8 34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8c-18.7 44.3-45.6 84.1-79.8 118.2z' fill='%23666'/%3E%3Cpath d='M664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360c-4.6 0-8.2 3.8-8 8.4 4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6c.2-4.6-3.4-8.4-8-8.4z' fill='%23666'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:bottom;background-size:30px}.pictool-module-panel .pictool-panel-nav-btn.panelnav-active{color:#17abe3}.pictool-module-panel .pictool-panel-nav-btn.panelnav-active.panelnav-icon:before{content:\"\";position:absolute;top:0;left:0;right:0;height:40px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zM288 421c0-26.5 21.5-48 48-48s48 21.5 48 48-21.5 48-48 48-48-21.5-48-48zm224 272c-85.5 0-155.6-67.3-160-151.6-.2-4.6 3.4-8.4 8-8.4h48.1c4.2 0 7.8 3.2 8.1 7.4C420 589.9 461.5 629 512 629s92.1-39.1 95.8-88.6c.3-4.2 3.9-7.4 8.1-7.4H664c4.6 0 8.2 3.8 8 8.4-4.4 84.3-74.5 151.6-160 151.6zm176-224c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z' fill='%2317abe3'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:bottom;background-size:30px}");var B=(O.prototype.show=function(){this._actionSheet.show()},O.prototype.hide=function(){this._actionSheet.hide()},O.prototype._render=function(t){if(!0!==this._hasRendered){var e=this._opts,o=e.navList,n=e.title,i=4<o.length,a='\n      <div class="pictool-module-panel">\n        <div class="pictool-panel-header">\n          <div class="pictool-panel-btn-close"></div>\n          <div class="pictool-panel-title">'+(n||"")+'</div>\n        </div>\n        <div class="pictool-panel-navigation">\n          <div class="pictool-panel-navlist '+(1==i?"panel-beyond-width":"")+'" \n            style="'+(1==i?"width: "+80*(o.length+1)+"px":"")+'"\n          >\n          '+(r(o)&&o.map(function(t,e){return' \n            <div class="pictool-panel-nav-btn panelnav-icon"\n              data-panel-nav-idx="'+e+'"\n            >\n              <span>'+t.name+"</span>\n            </div>\n            "}).join(""))+"\n          </div>\n        </div>\n      </div>\n    ";t.innerHTML=a,this._registerEvent(t),this._hasRendered=!0}},O.prototype._registerEvent=function(t){if(!0!==this._hasRendered){var e=this,n=this._opts.navList,i=t.querySelectorAll("[data-panel-nav-idx]");t.querySelector("div.pictool-panel-btn-close").addEventListener("click",function(){e.hide()}),!0===p(i)&&i.forEach(function(t){t.addEventListener("click",function(t){var e=1*this.getAttribute("data-panel-nav-idx"),o=n[e].feedback();h(o)?o.then(function(t){t&&E.trigger("GlobalEvent.moduleSketch.renderImage",t)}).catch(function(t){console.log(t)}):!0!==d(o)&&console.warn("feedback is not a promise or null"),i.forEach(function(t){t.classList.remove("panelnav-active")}),this.classList.add("panelnav-active")})})}},O);function O(t){this._actionSheet=null,this._opts=null,this._hasRendered=!1,this._opts=t;var o=this,e=t.zIndex,n=t.mount,i=new V({height:120,mount:n,zIndex:e,afterRender:function(t){var e=t.contentMount;o._render(e)},beforeHide:function(){E.trigger("GlobalEvent.moduleDashboard.progress.hide")}});this._actionSheet=i}function F(t,e){return new Promise(function(o,n){try{!function(t,e){var o=t.key,n=t.param,i=t.feedback,a=e.path,r=new Worker(a);r.onmessage=function(t){"function"==typeof i&&i(t.data.result,t.data.error)},r.onerror=function(t){"function"==typeof i&&i(null,t.message)},r.postMessage({key:o,param:n})}({key:t.key,param:t.param,feedback:function(t,e){e?n(e):o(t)}},e)}catch(t){n(t)}})}var N=(U.prototype._render=function(){if(!0!==this._hasRendered){var t='\n      <div class="pictool-module-dashboard" style="z-index:'+this._opts.zIndex+';">\n        <div class="pictool-dashboard-navlist">\n          <div class="pictool-dashboard-nav-btn dashboard-filter" data-nav-action="filter" >\n            <span>滤镜</span>\n          </div>\n          <div class="pictool-dashboard-nav-btn dashboard-adjust" data-nav-action="adjust" >\n            <span>调节</span>\n          </div>\n          <div class="pictool-dashboard-nav-btn dashboard-edit" data-nav-action="edit" >\n            <span>编辑</span>\n          </div>\n          \x3c!--\n          <div class="pictool-dashboard-nav-btn dashboard-text" data-nav-action="text" >\n            <span>文字</span>\n          </div>\n          --\x3e\n        </div>\n      </div>\n    ';this._mount.innerHTML=t,this._registerEvent(),this._hasRendered=!0}},U.prototype._registerEvent=function(){if(!0!==this._hasRendered){var t=this._opts,e=t.zIndex,o=(t.workerConfig,this._mount.querySelector('[data-nav-action="filter"]')),n=this._mount.querySelector('[data-nav-action="adjust"]'),i=this._mount.querySelector('[data-nav-action="edit"]'),a=(this._mount.querySelector('[data-nav-action="text"]'),this._mount,this._initFilterPanel());o.addEventListener("click",function(){a.show()});var r=this._initAdjustPanel();n.addEventListener("click",function(){r.show()});var c=this._initEditPanel();i.addEventListener("click",function(){c.show()});var s=new q({mount:this._mount,percent:40,max:100,min:-100,customStyle:{"z-index":e+1,position:"fixed",bottom:"140px",left:"5%",right:"5%",width:"auto"},onChange:function(t){console.log("data =",t)}});s.hide(),E.on("GlobalEvent.moduleDashboard.progress.show",function(t){void 0===t&&(t={});var e=t.percent,o=t.onChange;s.resetOnChange(o),s.resetPercent(e),s.show()}),E.on("GlobalEvent.moduleDashboard.progress.hide",function(){s.resetOnChange(null),s.resetPercent(50),s.hide()});var l=new T({zIndex:e+1e3});E.on("GlobalEvent.moduleDashboard.loading.show",function(t){var e=-1;t&&0<t.timeout&&(e=t.timeout),l.show(e)}),E.on("GlobalEvent.moduleDashboard.loading.hide",function(){l.hide()})}},U.prototype._initFilterPanel=function(){var t=this._opts,e=t.zIndex,i=t.workerConfig;return new B({title:"滤镜",mount:this._mount,zIndex:e+1,navList:[{name:"原图",feedback:function(){var t=M("Sketch.originSketchSchema");return Promise.resolve(t)}},{name:"黑白",feedback:function(){var t=M("Sketch.originSketchSchema"),n=I(t);return new Promise(function(o,e){F({key:"gray",param:{imageData:n,options:{}}},i).then(function(t){var e=R(t);o(e)}).then(function(t){e(t)})})}},{name:"人物识别",feedback:function(){var t=M("Sketch.originSketchSchema"),n=I(t);return new Promise(function(o,e){F({key:"personSkin",param:{imageData:n,options:{}}},i).then(function(t){var e=R(t);o(e)}).then(function(t){e(t)})})}}]})},U.prototype._initAdjustPanel=function(){var t=this._opts,e=t.zIndex,o=t.workerConfig;return new B({title:"调节",mount:this._mount,zIndex:e+1,navList:[{name:"亮度",feedback:function(){var t=M("Sketch.originSketchSchema"),e=I(t);return E.trigger("GlobalEvent.moduleDashboard.progress.show",{percent:50,onChange:function(t){E.trigger("GlobalEvent.moduleDashboard.loading.show"),F({key:"transform",param:{imageData:e,options:{percent:{l:t.value||0}}}},o).then(function(t){var e=R(t);E.trigger("GlobalEvent.moduleSketch.renderImage",e),E.trigger("GlobalEvent.moduleDashboard.loading.hide")}).catch(function(t){console.log(t),E.trigger("GlobalEvent.moduleDashboard.loading.hide")})}}),null}},{name:"对比度",feedback:function(){var t=M("Sketch.originSketchSchema");return Promise.resolve(t)}},{name:"饱和度",feedback:function(){var t=M("Sketch.originSketchSchema");return Promise.resolve(t)}},{name:"锐化",feedback:function(){var t=M("Sketch.originSketchSchema");return Promise.resolve(t)}},{name:"虚化",feedback:function(){var t=M("Sketch.originSketchSchema");return Promise.resolve(t)}}]})},U.prototype._initEditPanel=function(){var t=this._opts.zIndex;return new B({title:"编辑",mount:this._mount,zIndex:t+1,navList:[{name:"旋转",feedback:function(){var t=M("Sketch.originSketchSchema");return Promise.resolve(t)}}]})},U);function U(t,e){this._mount=null,this._opts=null,this._hasRendered=!1,this._mount=t,this._opts=e,this._render()}t(".pictool-module-header{position:relative;font-size:14px;color:#fff}.pictool-module-header .pictool-header-btn-close{position:absolute;left:0;top:0;width:60px;height:40px}.pictool-module-header .pictool-header-btn-close:before{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9c-4.4 5.2-.7 13.1 6.1 13.1h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z' fill='%23fff'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:50%;background-size:30px}.pictool-module-header .pictool-header-btn-save{position:absolute;right:0;top:0;width:60px;height:40px}.pictool-module-header .pictool-header-btn-save:before{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840z' fill='%23fff'/%3E%3Cpath d='M512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z' fill='%23fff'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:50%;background-size:30px}");var W=(X.prototype._render=function(){!0!==this._hasRendered&&(this._mount.innerHTML='\n      <div class="pictool-module-header">\n        <div class="pictool-header-btn-close"></div>\n        <div class="pictool-header-btn-save"></div>\n      </div>\n    ',this._registerEvent(),this._hasRendered=!0)},X.prototype._registerEvent=function(){var t=this._mount.querySelector("div.pictool-header-btn-close"),e=this._mount.querySelector("div.pictool-header-btn-save"),o=this._opts;t.addEventListener("click",function(){l(o.closeFeedback)&&o.closeFeedback()}),e.addEventListener("click",function(){l(o.saveFeedback)&&o.saveFeedback()})},X);function X(t,e){this._mount=null,this._opts=null,this._hasRendered=!1,this._mount=t,this._opts=e,this._render()}function J(c,t){void 0===t&&(t={uiConfig:{},workerConfig:{path:""}}),this._imageData=null,this._sketch=null,this._dashboard=null,this._header=null,this._imageData=c;var e=(this._options=t).uiConfig,o=void 0===e?{}:e,s=t.workerConfig,l=o.zIndex;0<1*l||(l=1e3);var d=this,h=new n({zIndex:l,afterRender:function(t){var e=t.contentMount,o=t.headerMount,n=t.footerMount,i=new W(o,{closeFeedback:function(){h.hide()},saveFeedback:function(){E.trigger("GlobalEvent.moduleSketch.downloadImage")}}),a=new P(e,{imageData:c}),r=new N(n,{zIndex:l+1,workerConfig:s});d._sketch=a,d._dashboard=r,d._header=i}});this._mask=h}return J.prototype.show=function(){var t=M("Sketch.originSketchSchema");this._sketch.renderImage(t),this._mask.show()},J.prototype.hide=function(){this._mask.hide()},J});
